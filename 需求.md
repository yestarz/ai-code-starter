你现在是一个资深 TypeScript/Node.js CLI 工具工程师。请为我从零实现一个命令行工具 **acs**，满足下面的要求与规范。最终输出一个可直接运行的项目（包含 `package.json`、源码、构建脚本、README、简单测试），并保证在 Windows 与 macOS/Linux 下都可运行。

## 1. 目标与上下文

* 工具名称：`acs`
* 功能：读取与维护一个配置文件 `~/.acs/config.json`，并基于配置中的 `projects` 与 `cli` 列表提供 4 个命令：

  * `acs list` (别名 `ls`)
  * `acs remove` (别名 `rm`)
  * `acs code`
  * `acs add`
* 交互：使用命令行交互式选择与确认（使用 `inquirer`）。
* 运行环境：Node.js 18+，TypeScript。
* 打包方式：使用 `tsup` 或 `ts-node` 开发运行，发布用 `tsx` 或 `tsup` 均可。要求提供 `npm run build` 与 `npm link` 之后可通过全局命令 `acs` 调用。

## 2. 配置文件

* 路径固定为：`~/.acs/config.json`。需要在不同平台上正确解析用户目录（使用 `os.homedir()`）。
* 若文件不存在，首次运行时自动创建，内容为：

  ```json
  {
    "projects": [],
    "cli": []
  }
  ```
* 配置结构示例：

  ```json
  {
    "projects":[
      { "name":"tea-api", "path":"D://code//my//tea-api" }
    ],
    "cli":[
      { "name":"codex", "command":"codex" },
      { "name":"claude code", "command":"claude" }
    ]
  }
  ```

## 3. 命令设计

### 3.1 `acs list` / `acs ls`

* 作用：打印 `config.json` 中 `projects` 列表。
* 输出格式：表格或列表，包含序号、name、path。若为空，友好提示“暂无项目”。

### 3.2 `acs remove` / `acs rm`

* 作用：通过下拉选择一个或多个项目进行删除。
* 流程：

  1. 读取 `projects` 列表，若为空则提示无可删除项目并退出。
  2. 使用复选框多选（`inquirer`），默认不选。
  3. 二次确认（`confirm`）。只有确认后才修改配置写回文件。
  4. 删除成功后提示删除的项目名数量。
* 可靠性：

  * 写入前进行备份：在同目录生成 `config.json.bak`。
  * 写入失败时回滚到备份，打印错误信息。

### 3.3 `acs code`

* 作用：让用户选择一个项目，然后选择一个 CLI 工具（来自 `config.json` 的 `cli` 列表）。随后在该项目路径作为工作目录下，执行所选 `cli` 的 `command`。
* 流程：

  1. 下拉选择项目（显示 `name`，附带 `path` 作为描述）。
  2. 下拉选择 CLI 工具（显示 `name`，内部使用 `command` 字段）。
  3. 切换子进程的 `cwd` 为项目路径。
  4. 使用 `child_process.spawn` 执行命令，继承 stdio，让用户可以与该 CLI 交互。
  5. 子进程退出后把退出码打印给用户。
* 校验：

  * 项目路径不存在时，提示不可用并中止。
  * `cli` 列表为空时，提示需要先在 `config.json` 添加可用 CLI。

### 3.4 `acs add`

* 作用：向 `projects` 添加一个新项目。
* 流程：

  1. 提示用户输入一个项目路径，例如 `D://code//my//tea-api`。
  2. 判断路径是否存在且为目录，不存在则报错并允许重试输入。
  3. 根据路径解析项目名：取路径最后一段作为 `name`，如 `.../tea-api` → `tea-api`。
  4. 若 `projects` 中已存在相同 `path` 或相同 `name`，需要二次确认是否仍要添加（避免重复）。
  5. 写入配置并提示“添加成功：{name} -> {path}”。

## 4. 工程与代码结构

请按以下结构输出工程：

```
  package.json
  tsconfig.json
  README.md
  src/
    index.ts           # CLI 入口，解析子命令与别名
    config.ts          # 读取、写入、校验配置，提供备份/回滚机制
    commands/
      list.ts
      remove.ts
      code.ts
      add.ts
    types.ts           # 配置类型与命令返回类型
    utils/
      fs.ts            # 与文件系统相关的工具（确保跨平台路径处理）
      path.ts
      spawn.ts         # 封装 child_process.spawn，附加日志
  test/
    smoke.test.ts      # 关键流程的最小化冒烟测试（可用 vitest）
```

### 4.1 依赖要求

* 生产依赖：`inquirer`, `chalk` 或 `colorette`, `zod`（用于配置校验，可选）, `cross-spawn` 或原生 `child_process`
* 开发依赖：`typescript`, `tsup` 或 `tsx`, `vitest`, `@types/node`

### 4.2 `package.json` 要求

* 提供可全局安装与运行的 bin：

  ```json
  {
    "bin": { "acs": "dist/index.cjs" },
    "type": "module"
  }
  ```

  或使用 ESM 输出，确保 `npm link` 后可以直接通过 `acs` 执行。
* scripts 示例：

  ```json
  {
    "scripts": {
      "dev": "tsx src/index.ts",
      "build": "tsup src/index.ts --format cjs --dts --minify",
      "test": "vitest run"
    }
  }
  ```

### 4.3 关键实现细节

* 配置类型（`types.ts`）：

  ```ts
  export interface Project { name: string; path: string; }
  export interface CliTool { name: string; command: string; }
  export interface AcsConfig { projects: Project[]; cli: CliTool[]; }
  ```
* `config.ts`：

  * `getConfigPath()`：返回绝对路径 `~/.acs/config.json`，若目录不存在则递归创建。
  * `readConfig(): AcsConfig`：若文件不存在则写入默认空配置再读取。用 Zod 进行 schema 校验，填补缺省字段。
  * `writeConfig(next: AcsConfig)`：先备份当前文件到 `config.json.bak`，写入失败则恢复备份。
* `list.ts`：

  * 读取配置，格式化输出列表。支持 `--json` 参数输出原始 JSON。
* `remove.ts`：

  * 复选选择项目，`confirm` 二次确认，提交后写回。
* `code.ts`：

  * 单选项目与 CLI。使用封装的 `spawn()`：

    ```ts
    spawn(cmd: string, args: string[], opts: { cwd?: string }): Promise<number>
    ```
  * Windows 兼容：如果 `command` 字段是单个字符串，需正确拆分可执行名与参数；或通过 `shell: true` 简化跨平台调用。
* `add.ts`：

  * 使用 `inquirer` 的 `input` 循环校验路径存在性。
  * 解析项目名：使用 `path.basename(实际存在的绝对路径)`。
  * 若重名或重路径，给出警告并确认是否继续。
* 所有命令的错误处理：使用统一的错误打印与非零退出码。

### 4.4 用户体验与可用性

* 颜色输出：项目名高亮，路径用灰色。
* 空列表时给出“如何添加”的提示：`acs add`。
* 输入 Windows 路径时支持 `D:\code\my\tea-api` 与 `D://code//my//tea-api` 两种写法，内部统一转为绝对规范化路径。
* 对于 `acs code`：若 `cli` 为空，提示用户先在配置里添加 CLI 工具示例，并打印当前配置文件路径供编辑。

## 5. README.md 要求

README 需要包含：

* 安装与构建

  * `npm i`
  * `npm run build`
  * `npm link`
* 初始配置文件位置与结构说明，给出示例 `config.json`
* 命令用法与示例：

  * `acs ls`
  * `acs rm`
  * `acs code`
  * `acs add`
* 常见问题：

  * 权限问题
  * Windows 路径分隔符
  * `cli` 列表为空如何处理

## 6. 行为验收标准（自动或手动验证）

1. 首次运行 `acs ls` 时若 `~/.acs/config.json` 不存在，会自动创建空配置并提示“暂无项目”。
2. 运行 `acs add` 输入存在的路径后，自动解析最后一段为项目名并写入，`acs ls` 能看到新条目。
3. 运行 `acs rm` 时可多选删除，确认后 `acs ls` 看不到被删项目。
4. `acs code` 在所选项目目录下启动所选 CLI 命令，子进程的输出直接透传到终端。
5. 写配置失败时会回滚到 `.bak`，并打印明确错误。
6. 所有命令在 Windows 和 macOS/Linux 下都能工作。

## 7. 额外细节与品质

* 使用严格 TypeScript 配置（`strict: true`）。
* 统一日志与错误处理工具函数，提供 `--verbose` 切换更详细日志。
* 保持代码模块化与注释清晰，每个命令文件顶部写用途注释。
* 提供一个最小 `vitest` 冒烟测试：模拟临时 HOME 目录，验证创建配置与添加/列出项目的流程。

请直接生成完整项目的所有文件内容。生成完成后，给出三段命令作为快速启动校验：

```
npm i
npm run build && npm link
acs ls
```

---
